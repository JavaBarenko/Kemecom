<polymer-element name="k-update-password">
    <template>
        <link rel="stylesheet" href="../assets/k-profile.css" />
        <section class="profile">
            <h3>Alterar Senha</h3>
            <article>
                <p>
                <h4>E-Mail</h4>
                <label id="email"></label>
                </p>
                <h4>Alteração de senha</h4>
                <article class="passwordChange">
                    <p>
                        <label for="currPassword">Senha atual:&nbsp;</label>
                        <input id="currPassword" type="password" type="text" maxlength="20" placeholder="Senha atual">
                    </p>
                    <p>
                        <label for="password">Senha:&nbsp;</label>
                        <input id="password" type="password" placeholder="Nova Senha" maxlength="20">
                    </p>
                    <p>
                        <label for="password2">Senha:&nbsp;</label>
                        <input id="password2" type="password" placeholder="Confirmação de Senha" maxlength="20">
                    </p>
                </article>
                <p>
                    <button on-click="save">Salvar Alteração</button>
                    <button on-click="cancel">Cancelar</button>
                </p>
            </article>
        </section>
    </template>

    <script>
        Polymer('k-update-password', {
            save: function() {
                jQuery.ajax({
                    url: "/Kemecom-web/ws/user/password",
                    dataType: "json",
                    type: "POST",
                    context: this,
                    data: {
                        currPassword: this.$.currPassword.value,
                        password: this.$.password.value
                    },
                    beforeSend: function(xhr, settings) {
                        xhr.setRequestHeader('KemecomToken', K.getToken());
                    }
                }).done(function(data, status, xhr) {
                    if (data.successful) {
                        K.message.showSuccess(data.message);
                        K.goTo('profile');
                    } else {
                        K.message.showError(data.message);
                        this.$.currPassword.value = "";
                        this.$.password.value = "";
                        this.$.password2.value = "";
                    }
                }).fail(function(xhr, error, errorMsg) {
                    K.message.showError('Erro [' + error + "]:" + errorMsg);
                    K.goTo('k-profile');
                });
            },
            cancel: function() {
                K.goTo('profile');
            },
            ready: function() {
            }
        });
    </script>
</polymer-element>