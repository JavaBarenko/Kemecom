<polymer-element name="k-login">
    <template>
        <link rel="stylesheet" href="../assets/style.css" />
        <div class="component">
            <header>
                <h3>Login</h3>
                <p><strong>Insira seu E-Mail e senha para acessar o sistema</strong>
                </p>
            </header>
            <article>
                <p>
                    <label for="email">E-Mail:&nbsp;</label>
                    <input id="email" type="email" placeholder="E-Mail" maxlength="120">
                </p>
                <p>
                    <label for="password">Senha:&nbsp;</label>
                    <input type="password" id="password" placeholder="Senha" maxlength="20" on-change="enterPressed">
                </p>
                <a href="#" on-click="rememberPassword">Esqueci minha senha...</a>
                <p class="buttonPanel">
                    <button on-click="login">Entrar</button>
                    <button on-click="register">Criar conta</button>
                </p>
            </article>
        </div>
    </template>

    <script>
        Polymer('k-login', {
            ready: function() {
                this.$.email.focus();
            },
            rememberPassword: function(e) {
                e.preventDefault();
                K.goTo("k-remember-password");
            },
            enterPressed: function(e) {
                if (event.which == 13 || event.keyCode == 13) {
                    this.login();
                }
            },
            login: function() {
                jQuery.ajax({
                    url: "/Kemecom-web/ws/auth",
                    dataType: "json",
                    type: "POST",
                    context: this,
                    data: {
                        email: this.$.email.value,
                        password: this.$.password.value
                    }
                }).done(function(data, status, xhr) {
                    if (data.successful) {
                        K.message.showSuccess(data.message);
                        K.setToken(data.object);
                        amplify.publish("auth/loggined");
                        K.goTo('k-profile');
                    } else {
                        K.message.showError(data.message);
                        K.goTo('k-login');
                    }
                }).fail(function(xhr, error, errorMsg) {
                    K.message.showError('Erro [' + error + "]:" + errorMsg);
                    K.goTo('k-login');
                });
            },
            register: function() {
                K.goTo("k-sign-in");
            }
        });
    </script>
</polymer-element>